<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="twitter:card" content="summary_large_image" /><!-- Begin Jekyll SEO tag v2.6.1 -->
<title>How much chemistry to be useful? | Cheminformatics at IOC</title>
<meta name="generator" content="Jekyll v4.1.1" />
<meta property="og:title" content="How much chemistry to be useful?" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Training with low chemical information." />
<meta property="og:description" content="Training with low chemical information." />
<link rel="canonical" href="https://marcossantanaioc.github.io/fiocruzcheminformatics/jupyter/2020/12/04/first.html" />
<meta property="og:url" content="https://marcossantanaioc.github.io/fiocruzcheminformatics/jupyter/2020/12/04/first.html" />
<meta property="og:site_name" content="Cheminformatics at IOC" />
<meta property="og:image" content="https://marcossantanaioc.github.io/fiocruzcheminformatics/images/chemceptionfig1.png" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2020-12-04T00:00:00-06:00" />
<script type="application/ld+json">
{"headline":"How much chemistry to be useful?","dateModified":"2020-12-04T00:00:00-06:00","datePublished":"2020-12-04T00:00:00-06:00","url":"https://marcossantanaioc.github.io/fiocruzcheminformatics/jupyter/2020/12/04/first.html","@type":"BlogPosting","image":"https://marcossantanaioc.github.io/fiocruzcheminformatics/images/chemceptionfig1.png","mainEntityOfPage":{"@type":"WebPage","@id":"https://marcossantanaioc.github.io/fiocruzcheminformatics/jupyter/2020/12/04/first.html"},"description":"Training with low chemical information.","@context":"https://schema.org"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/fiocruzcheminformatics/assets/css/style.css"><link type="application/atom+xml" rel="alternate" href="https://marcossantanaioc.github.io/fiocruzcheminformatics/feed.xml" title="Cheminformatics at IOC" /><link rel="shortcut icon" type="image/x-icon" href="/fiocruzcheminformatics/images/favicon.ico"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Primer/15.2.0/primer.css" integrity="sha512-xTz2ys4coGAOz8vuV1NcQBkgVmKhsSEtjbqyMJbBHRplFuvKIUo6xhLHpAyPt9mfR6twHJgn9OgVLuqOvjeBhg==" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.14.0/css/all.min.css" integrity="sha512-1PKOgIY59xJ8Co8+NE6FZ+LOAZKjy+KY8iq0G4B3CyeY6wYHN3yt9PW0XpSriVlkMXe40PTKnXrLnZ9+fkDaog==" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.css" integrity="sha512-h7nl+xz8wgDlNM4NqKEM4F1NkIRS17M9+uJwIGwuo8vGqIl4BhuCKdxjWEINm+xyrUjNCnK5dCrhM0sj+wTIXw==" crossorigin="anonymous" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/katex.min.js" integrity="sha512-/CMIhXiDA3m2c9kzRyd97MTb3MC6OVnx4TElQ7fkkoRghwDf6gi41gaT1PwF270W6+J60uTmwgeRpNpJdRV6sg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.12.0/contrib/auto-render.min.js" integrity="sha512-Do7uJAaHZm5OLrIv/yN4w0iG1dbu01kzdMNnFfu/mAqgUk6Nniv2JYHcwH+cNwjqgLcqcuBBk+JRvprLVI8azg==" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha512-0doc9hKxR3PYwso42RD1p5ySZpzzuDiOwMrdCEh2WdJZCjcmFKc/wEnL+z8fBQrnHoiNWbo+3fiGkOYXBdQp4A==" crossorigin="anonymous"></script>
    <script>
    document.addEventListener("DOMContentLoaded", function() {
        renderMathInElement( document.body, {
        delimiters: [
            {left: "$$", right: "$$", display: true},
            {left: "[%", right: "%]", display: true},
            {left: "$", right: "$", display: false}
        ]}
        );
    });
    </script>


<script>
function wrap_img(fn) {
    if (document.attachEvent ? document.readyState === "complete" : document.readyState !== "loading") {
        var elements = document.querySelectorAll(".post img");
        Array.prototype.forEach.call(elements, function(el, i) {
            if (el.getAttribute("title") && (el.className != "emoji")) {
                const caption = document.createElement('figcaption');
                var node = document.createTextNode(el.getAttribute("title"));
                caption.appendChild(node);
                const wrapper = document.createElement('figure');
                wrapper.className = 'image';
                el.parentNode.insertBefore(wrapper, el);
                el.parentNode.removeChild(el);
                wrapper.appendChild(el);
                wrapper.appendChild(caption);
            }
        });
    } else { document.addEventListener('DOMContentLoaded', fn); }
}
window.onload = wrap_img;
</script>

<script>
    document.addEventListener("DOMContentLoaded", function(){
    // add link icon to anchor tags
    var elem = document.querySelectorAll(".anchor-link")
    elem.forEach(e => (e.innerHTML = '<i class="fas fa-link fa-xs"></i>'));
    });
</script>
</head>
<body><header class="site-header">

  <div class="wrapper"><a class="site-title" rel="author" href="/fiocruzcheminformatics/">Cheminformatics at IOC</a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/fiocruzcheminformatics/about/">About Me</a><a class="page-link" href="/fiocruzcheminformatics/search/">Search</a><a class="page-link" href="/fiocruzcheminformatics/categories/">Tags</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

  <header class="post-header">
    <h1 class="post-title p-name" itemprop="name headline">How much chemistry to be useful?</h1><p class="page-description">Training with low chemical information.</p><p class="post-meta post-meta-title"><time class="dt-published" datetime="2020-12-04T00:00:00-06:00" itemprop="datePublished">
        Dec 4, 2020
      </time>
       • <span class="read-time" title="Estimated read time">
    
    
      17 min read
    
</span></p>

    
      <p class="category-tags"><i class="fas fa-tags category-tags-icon"></i></i> 
      
        <a class="category-tags-link" href="/fiocruzcheminformatics/categories/#jupyter">jupyter</a>
        
      
      </p>
    

    
      
        <div class="pb-5 d-flex flex-wrap flex-justify-end">
          <div class="px-2">

    <a href="https://github.com/marcossantanaioc/fiocruzcheminformatics/tree/master/_notebooks/2020-12-04-first.ipynb" role="button" target="_blank">
<img class="notebook-badge-image" src="/fiocruzcheminformatics/assets/badges/github.svg" alt="View On GitHub">
    </a>
</div>

          <div class="px-2">
    <a href="https://mybinder.org/v2/gh/marcossantanaioc/fiocruzcheminformatics/master?filepath=_notebooks%2F2020-12-04-first.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/fiocruzcheminformatics/assets/badges/binder.svg" alt="Open In Binder"/>
    </a>
</div>

          <div class="px-2">
    <a href="https://colab.research.google.com/github/marcossantanaioc/fiocruzcheminformatics/blob/master/_notebooks/2020-12-04-first.ipynb" target="_blank">
        <img class="notebook-badge-image" src="/fiocruzcheminformatics/assets/badges/colab.svg" alt="Open In Colab"/>
    </a>
</div>
        </div>
      </header>

  <div class="post-content e-content" itemprop="articleBody">
    <ul class="section-nav">
<li class="toc-entry toc-h1"><a href="#So,-what-are-we-going-to-do?">So, what are we going to do? </a></li>
<li class="toc-entry toc-h1"><a href="#How-can-we-convert-molecules-to-images?">How can we convert molecules to images? </a></li>
<li class="toc-entry toc-h1"><a href="#Load-data">Load data </a></li>
<li class="toc-entry toc-h1"><a href="#Training-our-model">Training our model </a>
<ul>
<li class="toc-entry toc-h2"><a href="#1)-How-to-split-data">1) How to split data </a></li>
<li class="toc-entry toc-h2"><a href="#2)-Define-how-to-get-the-items">2) Define how to get the items </a></li>
<li class="toc-entry toc-h2"><a href="#3)-Define-the-targets">3) Define the targets </a></li>
<li class="toc-entry toc-h2"><a href="#Create-dataset">Create dataset </a></li>
<li class="toc-entry toc-h2"><a href="#Create-dataloaders">Create dataloaders </a></li>
<li class="toc-entry toc-h2"><a href="#Fit">Fit </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Interpretation">Interpretation </a>
<ul>
<li class="toc-entry toc-h2"><a href="#Let's-try-with-a-little-bit-of-data-augmentation.">Let&#39;s try with a little bit of data augmentation. </a></li>
</ul>
</li>
<li class="toc-entry toc-h1"><a href="#Exporting-the-model">Exporting the model </a></li>
<li class="toc-entry toc-h1"><a href="#Fin">Fin </a></li>
</ul><!--
#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: _notebooks/2020-12-04-first.ipynb
-->

<div class="container" id="notebook-container">
        
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description" open="">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="n">MolFromSmiles</span><span class="p">,</span> <span class="n">MolToSmiles</span>
<span class="kn">from</span> <span class="nn">fastai.vision.all</span> <span class="kn">import</span> <span class="o">*</span>
<span class="kn">from</span> <span class="nn">rdkit.Chem</span> <span class="kn">import</span> <span class="n">AllChem</span>
<span class="kn">from</span> <span class="nn">rdkit</span> <span class="kn">import</span> <span class="n">Chem</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">IPython.display</span>
<span class="kn">from</span> <span class="nn">PIL</span> <span class="kn">import</span> <span class="n">Image</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Hi! This is will be the first post from my new blog. I hope you guys enjoy it.</p>
<p>I'm doing the Fast.AI course and I decided to try solve some problems from my field of research (Cheminformatics) using the fastai package. In this blog, I will try to follow the chapters from the <a href="https://www.amazon.com.br/gp/product/1492045527/ref=ppx_yo_dt_b_asin_title_o00_s00?ie=UTF8&amp;psc=1">Deep Learning for Coders with fastai &amp; Pytorch</a>. For instance, this notebook was inspired by chapter 2 (the notebook version can be found <a href="https://github.com/fastai/fastbook/blob/master/02_production.ipynb">here</a>)</p>
<p>Let's begin!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="So,-what-are-we-going-to-do?">
<a class="anchor" href="#So,-what-are-we-going-to-do?" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>So, what are we going to do?</strong><a class="anchor-link" href="#So,-what-are-we-going-to-do?"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In this notebook we will try to solve a quantitative structure-activity relationship QSAR problem. What does this mean? Well, QSAR is a major aspect of Cheminformatics. The goal of QSAR is to find useful information in chemical and biological data and use this information for inference on new data. For example, we might want to predict if a molecule is active on a particular biological target. We could start with a dataset of experimentally measured bioactivities (e.g. $IC_{50}$ values, inhibition constants etc) and train a model for bioactivity prediction. This model can be used to predict the bioactivity of other molecules of interest. By using QSAR, BigPharma and research groups can generate new hypothesis much faster and cheaper than testing a bunch of molecules in vitro.</p>
<p>Traditionally, machine learning methods such as random forest, support vector machines and gradient boosting dominate the field. That's because these classical methods usually give very good results for a range of datasets and are quite easy to train. Until recently, researchers did not apply deep learning in large scale to bioactivity prediction. When they did, it was usually in the form of fully connected neural with just 2-5 layers. However, the last 5 years saw a BOOM in the number of publications using deep learning in very interesting ways! For example, recurrent neural networks are being applied to generate molecules, convnets are showing SOTA performance on binding affinity and pose prediction and multi-task learning was used successfully to win a Kaggle competition for bioactivity prediction!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The most common type of data for QSAR is tabular. Researchers usually calculate many chemical features to describe a collection of molecules. As an example, one of the most common consists in a binary vector indicating the presence/absence of chemical groups in a molecule. We can then use this <strong><em>fingerprint</em></strong> to train a macihine learning model for bioactivity prediction.</p>
<p>In this notebook we will use a different strategy. Instead of calculating a bunch of vectors, we'll convert each molecule to an image and feed that input to a neural network! As Jeremy said in the book:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote>
<p><code>Another point to consider is that although your problem might not look like a computer vision problem, it might be possible with a little imagination to turn it into one. For instance, if what you are trying to classify are sounds, you might try converting the sounds into images of their acoustic waveforms and then training a model on those images.</code></p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's try that!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="How-can-we-convert-molecules-to-images?">
<a class="anchor" href="#How-can-we-convert-molecules-to-images?" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>How can we convert molecules to images?</strong><a class="anchor-link" href="#How-can-we-convert-molecules-to-images?"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In reality, we are not going to convert molecules to images of molecules. What we actually need is a way to represent molecules the same way as images. That way consists of using arrays. For example, an image can be represented as 3D array of shape $(W, H, C)$, where $W$ is the width, $H$ is the height and $C$ is the number of channels. If we could do that to molecules, then it would be straightforward to use it as input to a model.</p>
<p>There are many ways to do that, but we are going to use one that I think is very interesting. In 2017, Garrett B. Goh, Charles Siegel, Abhinav Vishnu, Nathan O. Hodas and Nathan Baker published a preprint showing that machine learning models actually don't need to know much about chemistry or biology to make a prediction!</p>
<p>In their original <a href="https://arxiv.org/pdf/1710.02238.pdf">manuscript</a>, the authors called their model <strong>Chemception</strong> and showed that using very, very simple image-like inputs it was possible to achieve SOTA performance on some public datasets. That's quite an achievement! Until yesterday, the cheminformatics community was using handcrafted features and now it seems we don't even need to tell many things about molecules to train a predictive model!</p>
<p>As the author mentioned in the preprint:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote>
<p>In addition, it should be emphasized that no additional
source of chemistry-inspired features or inputs, such as molecular descriptors or fingerprints were
used in training the model. This means that Chemception was not explicitly provided with even
the most basic chemical concepts like “valency” or “periodicity”.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This means that Chemception had to learn A LOT about chemistry from scratch, using only not very informative inputs (to humans, at least)!</p>
<p>I really find this amazing!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote>
<p>Just to clarify:I'm not saying the model would be useful in real settings. But it is quite amazing to see a good performance without using elaborate chemical descriptors.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The Chemception model is a convolutional neural network for QSAR tasks. An overview of their method is shown below:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="https://depth-first.com/images/posts/20190204/chemception.png" alt=""></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Load-data">
<a class="anchor" href="#Load-data" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Load data</strong><a class="anchor-link" href="#Load-data"> </a>
</h1>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mols</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">'/home/marcossantana/Documentos/GitHub/fiocruzcheminformatics/_data/fxa_ic50_processed.csv'</span><span class="p">,</span><span class="n">sep</span><span class="o">=</span><span class="s1">';'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mols</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">2</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea output_execute_result">
<div>
<style scoped="">
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>doc_id</th>
      <th>standard_value</th>
      <th>standard_type</th>
      <th>standard_relation</th>
      <th>pchembl</th>
      <th>molregno</th>
      <th>canonical_smiles</th>
      <th>chembl_id</th>
      <th>target_dictionary</th>
      <th>target_chembl_id</th>
      <th>l1</th>
      <th>l2</th>
      <th>l3</th>
      <th>confidence_score</th>
      <th>act</th>
      <th>processed_smiles</th>
      <th>is_valid</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>47181</td>
      <td>1.5</td>
      <td>IC50</td>
      <td>=</td>
      <td>8.82</td>
      <td>459679</td>
      <td>COc1ccc(NC(=O)c2ccc(C(=N)N(C)C)cc2)c(C(=O)Nc2ccc(Cl)cn2)c1</td>
      <td>CHEMBL512351</td>
      <td>194</td>
      <td>CHEMBL244</td>
      <td>Enzyme</td>
      <td>Protease</td>
      <td>Serine protease</td>
      <td>8</td>
      <td>Active</td>
      <td>COc1ccc(NC(=O)c2ccc(C(=N)N(C)C)cc2)c(C(=O)Nc2ccc(Cl)cn2)c1</td>
      <td>False</td>
    </tr>
    <tr>
      <th>1</th>
      <td>30088</td>
      <td>29000.0</td>
      <td>IC50</td>
      <td>=</td>
      <td>4.54</td>
      <td>655811</td>
      <td>Cc1ccc(Oc2nc(Oc3cccc(C(=N)N)c3)c(F)c(NC(C)CCc3ccccc3)c2F)c(C(=O)O)c1</td>
      <td>CHEMBL193933</td>
      <td>194</td>
      <td>CHEMBL244</td>
      <td>Enzyme</td>
      <td>Protease</td>
      <td>Serine protease</td>
      <td>9</td>
      <td>Inactive</td>
      <td>Cc1ccc(Oc2nc(Oc3cccc(C(=N)N)c3)c(F)c(NC(C)CCc3ccccc3)c2F)c(C(=O)O)c1</td>
      <td>False</td>
    </tr>
  </tbody>
</table>
</div>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The <code>chemcepterize_mol</code> function below will take care of converting the molecules SMILES strings (a one-line representation of the chemical structure) to the image-like format that we want.</p>
<p>Our workflow will go like this: first we define an embedding dimension and a resolution.  You can think of this is a black canvas where the structures will be plotted and each atom will have a resolution consisting of how many pixels will be used to represent it. The dimensions of the canvas will be given by:</p>
<p>
$$DIM = \frac{EMBED*2}{RES}$$
</p>
<p>where $EMBED$ is the embedding size and  $RES$ the resolution</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The next step consists of calculating some basic chemical information from the structure, such as bond order, charges, atomic numbers and the hybridization states. This information will be converted into a matrix of shape $(P, DIM, DIM)$, where $P$ is the number of properties or channels in the image (in this case we will use 3) and $DIM$ is the dimension of the canvas.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The properties we will calculated are shown in the figure below from the original manuscript.</p>
<p><img src="/fiocruzcheminformatics/images/copied_from_nb/my_icons/chemception_filters.png" alt=""></p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">chemcepterize_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="mf">20.0</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mf">0.5</span><span class="p">):</span>
    <span class="n">dims</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">embed</span><span class="o">*</span><span class="mi">2</span><span class="o">/</span><span class="n">res</span><span class="p">)</span>
    <span class="c1">#print(dims)</span>
   
    <span class="c1">#print(mol)</span>
    <span class="c1">#print(",,,,,,,,,,,,,,,,,,,,,,")</span>
    <span class="n">cmol</span> <span class="o">=</span> <span class="n">Chem</span><span class="o">.</span><span class="n">Mol</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">ToBinary</span><span class="p">())</span>
    <span class="c1">#print(cmol)</span>
    <span class="c1">#print(",,,,,,,,,,,,,,,,,,,,,,")</span>
    <span class="n">cmol</span><span class="o">.</span><span class="n">ComputeGasteigerCharges</span><span class="p">()</span>
    <span class="n">AllChem</span><span class="o">.</span><span class="n">Compute2DCoords</span><span class="p">(</span><span class="n">cmol</span><span class="p">)</span>
    <span class="n">coords</span> <span class="o">=</span> <span class="n">cmol</span><span class="o">.</span><span class="n">GetConformer</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">GetPositions</span><span class="p">()</span>
    <span class="c1">#print(coords)</span>
    <span class="c1">#print(",,,,,,,,,,,,,,,,,,,,,,")</span>
    <span class="n">vect</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">dims</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="n">dims</span><span class="o">+</span><span class="mi">2</span><span class="p">,</span><span class="mi">4</span><span class="p">))</span> <span class="c1"># I added 2 pixels on to height and width because this function sometimes does not work if the molecule is too big.</span>
    
    <span class="c1">#Bonds first</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">bond</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">mol</span><span class="o">.</span><span class="n">GetBonds</span><span class="p">()):</span>
        <span class="n">bondorder</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">GetBondTypeAsDouble</span><span class="p">()</span>
        <span class="n">bidx</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">GetBeginAtomIdx</span><span class="p">()</span>
        <span class="n">eidx</span> <span class="o">=</span> <span class="n">bond</span><span class="o">.</span><span class="n">GetEndAtomIdx</span><span class="p">()</span>
        <span class="n">bcoords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">bidx</span><span class="p">]</span>
        <span class="n">ecoords</span> <span class="o">=</span> <span class="n">coords</span><span class="p">[</span><span class="n">eidx</span><span class="p">]</span>
        <span class="n">frac</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">res</span><span class="o">*</span><span class="mi">2</span><span class="p">))</span> <span class="c1">#</span>
        <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">frac</span><span class="p">:</span>
            <span class="n">c</span> <span class="o">=</span> <span class="p">(</span><span class="n">f</span><span class="o">*</span><span class="n">bcoords</span> <span class="o">+</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="n">f</span><span class="p">)</span><span class="o">*</span><span class="n">ecoords</span><span class="p">)</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">c</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">embed</span><span class="p">)</span><span class="o">/</span><span class="n">res</span><span class="p">))</span>
            <span class="n">idy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">c</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span> <span class="n">embed</span><span class="p">)</span><span class="o">/</span><span class="n">res</span><span class="p">))</span>
            <span class="c1">#Save in the vector first channel</span>
            <span class="n">vect</span><span class="p">[</span> <span class="n">idx</span> <span class="p">,</span> <span class="n">idy</span> <span class="p">,</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">bondorder</span>
            
    <span class="c1">#Atom Layers</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span><span class="n">atom</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">cmol</span><span class="o">.</span><span class="n">GetAtoms</span><span class="p">()):</span>
            <span class="n">idx</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="n">embed</span><span class="p">)</span><span class="o">/</span><span class="n">res</span><span class="p">))</span>
            <span class="n">idy</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">((</span><span class="n">coords</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span> <span class="n">embed</span><span class="p">)</span><span class="o">/</span><span class="n">res</span><span class="p">))</span>
            <span class="c1">#Atomic number</span>
            <span class="n">vect</span><span class="p">[</span> <span class="n">idx</span> <span class="p">,</span> <span class="n">idy</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">GetAtomicNum</span><span class="p">()</span>
            
            <span class="c1">#Hybridization</span>
            <span class="n">hyptype</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">GetHybridization</span><span class="p">()</span><span class="o">.</span><span class="n">real</span>
            <span class="n">vect</span><span class="p">[</span> <span class="n">idx</span> <span class="p">,</span> <span class="n">idy</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">hyptype</span>
            
            <span class="c1">#Gasteiger Charges</span>
            <span class="n">charge</span> <span class="o">=</span> <span class="n">atom</span><span class="o">.</span><span class="n">GetProp</span><span class="p">(</span><span class="s2">"_GasteigerCharge"</span><span class="p">)</span>
            <span class="n">vect</span><span class="p">[</span> <span class="n">idx</span> <span class="p">,</span> <span class="n">idy</span><span class="p">,</span> <span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="n">charge</span>

            
    <span class="k">return</span> <span class="n">Tensor</span><span class="p">(</span><span class="n">vect</span><span class="p">[:,</span> <span class="p">:,</span> <span class="p">:</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span> <span class="c1"># We will omit the last dimension just to fit our fastai models. But you can also adapt the architeture to deal with 4 or more channels.</span>
</pre></div>

    </div>
</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p></p>
<div class="flash">
    <svg class="octicon octicon-info" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>
    <strong>Note: </strong>an embedding of 32 will give a 128 x 128 canvas. We can use this correlation to generate images of any size. (224 * 32)/128.
</div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First, we will create a column called <code>mol</code> that maps our molecular structures to <code>rdkit.Chem.rdchem.Mol</code> objects. This is essential because we are going to use Rdkit to calculate everything and <code>rdkit.Chem.rdchem.Mol</code>  has a bunch of nice functionalities to work with molecular graphs.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mol</span><span class="o">=</span> <span class="n">MolFromSmiles</span><span class="p">(</span><span class="s1">'c1ccccc1'</span><span class="p">)</span> <span class="c1"># A rdkit.Chem.rdchem.Mol object representing benzene</span>
<span class="nb">type</span><span class="p">(</span><span class="n">mol</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>rdkit.Chem.rdchem.Mol</pre>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mols</span><span class="p">[</span><span class="s1">'mol'</span><span class="p">]</span> <span class="o">=</span> <span class="n">mols</span><span class="p">[</span><span class="s1">'processed_smiles'</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">MolFromSmiles</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we are going to vectorize our molecules and transform them to image-like matrices.But first, let's test our function.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="k">def</span> <span class="nf">vectorize</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">embed</span><span class="p">,</span> <span class="n">res</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">chemcepterize_mol</span><span class="p">(</span><span class="n">mol</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="n">embed</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="n">res</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">v</span> <span class="o">=</span> <span class="n">vectorize</span><span class="p">(</span><span class="n">mols</span><span class="p">[</span><span class="s2">"mol"</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">embed</span><span class="o">=</span><span class="mi">56</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Ok, now let's see what that does!</p>
<p>As you can see, the image is mostly black space and the molecule is just a tiny, tiny part of it (shown in red). The black spaces have no chemical information at all! That's why the authors said Chemception had to learn everything from scratch!</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">print</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">shape</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(226, 226, 3)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.image.AxesImage at 0x7fac6c69b590&gt;</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can make bigger molecules by reducing the embedding size. <strong><em>But beware that will also reduce the total image size</em></strong>.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">larger_img</span> <span class="o">=</span> <span class="n">vectorize</span><span class="p">(</span><span class="n">mols</span><span class="p">[</span><span class="s2">"mol"</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span><span class="n">embed</span><span class="o">=</span><span class="mi">16</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="nb">print</span><span class="p">((</span><span class="n">larger_img</span><span class="o">.</span><span class="n">shape</span><span class="p">)))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">larger_img</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>(66, 66, 3)
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.image.AxesImage at 0x7fac6c601150&gt;</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mols</span><span class="p">[</span><span class="s2">"molimage"</span><span class="p">]</span> <span class="o">=</span> <span class="n">mols</span><span class="p">[</span><span class="s2">"mol"</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="n">partial</span><span class="p">(</span><span class="n">vectorize</span><span class="p">,</span> <span class="n">embed</span><span class="o">=</span><span class="mi">32</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="mf">0.25</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">mols</span><span class="p">[</span><span class="s2">"molimage"</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Clipping input data to the valid range for imshow with RGB data ([0..1] for floats or [0..255] for integers).
</pre>
</div>
</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>&lt;matplotlib.image.AxesImage at 0x7fac6c51ce90&gt;</pre>
</div>

</div>

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Training-our-model">
<a class="anchor" href="#Training-our-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Training our model<a class="anchor-link" href="#Training-our-model"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that we know how to convert the molecules to the desired format, we are ready to train a model using fastai! In order to do that, we need to define <strong>three things</strong></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="1)-How-to-split-data">
<a class="anchor" href="#1)-How-to-split-data" aria-hidden="true"><span class="octicon octicon-link"></span></a>1) <strong>How to split data</strong><a class="anchor-link" href="#1)-How-to-split-data"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First, let's define how to split our data into training and validation sets. Luckly, our dataset comes with a column called "is_valid" showing which molecules should be used for validation and training. Therefore, we will use the <code>ColSplitter</code> class from fastai to get the indeces. We could also do a random split here or any kind at all. Fastai is very flexible!</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">splits</span> <span class="o">=</span> <span class="n">ColSplitter</span><span class="p">(</span><span class="s1">'is_valid'</span><span class="p">)(</span><span class="n">mols</span><span class="p">)</span>
<span class="n">splits</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>((#1703) [0,1,2,3,4,5,6,7,8,9...],
 (#426) [1703,1704,1705,1706,1707,1708,1709,1710,1711,1712...])</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="2)-Define-how-to-get-the-items">
<a class="anchor" href="#2)-Define-how-to-get-the-items" aria-hidden="true"><span class="octicon octicon-link"></span></a>2) <strong>Define how to get the items</strong><a class="anchor-link" href="#2)-Define-how-to-get-the-items"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We need to tell fastai how to get the items that we'll feed to our model. In this case, we will use the images we created and stored in the "molimage" column of our dataframe.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x_tfms</span> <span class="o">=</span> <span class="n">ColReader</span><span class="p">(</span><span class="s1">'molimage'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="3)-Define-the-targets">
<a class="anchor" href="#3)-Define-the-targets" aria-hidden="true"><span class="octicon octicon-link"></span></a>3) <strong>Define the targets</strong><a class="anchor-link" href="#3)-Define-the-targets"> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now we need to tell fastai where are our targets. In this case, our targets are in the column "act", showing the bioactivity of each molecule. We will also tell fastai to treat the values of this column as categories, which will be used to train a classification model.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">y_tfms</span> <span class="o">=</span> <span class="p">[</span><span class="n">ColReader</span><span class="p">(</span><span class="s1">'act'</span><span class="p">),</span><span class="n">Categorize</span><span class="p">]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<blockquote>
<p>The fastai book uses the DataBlock functionality to create the dataloaders at Chapter 2 and Jeremy says that we actually need <strong>four things</strong></p>
<ol>
<li>What kind of data to work with;</li>
<li>How to get the items;</li>
<li>How to label these items;</li>
<li>How to create a validation set.</li>
</ol>
<p>But since we are using a custom data type, we'll skip the step defining the kind of data.</p>
</blockquote>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-dataset">
<a class="anchor" href="#Create-dataset" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Create dataset</strong><a class="anchor-link" href="#Create-dataset"> </a>
</h2>
<p>Now we can create our dataset:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">mol_dataset</span> <span class="o">=</span> <span class="n">Datasets</span><span class="p">(</span><span class="n">mols</span><span class="p">,[</span><span class="n">x_tfms</span><span class="p">,</span><span class="n">y_tfms</span><span class="p">],</span> <span class="n">splits</span><span class="o">=</span><span class="n">splits</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Code" data-close="Show Code"></summary>
        <p></p>
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">mol_dataset</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">x</span><span class="o">.</span><span class="n">shape</span><span class="p">,</span><span class="n">y</span>
</pre></div>

    </div>
</div>
</div>

    </details>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(torch.Size([3, 258, 258]), TensorCategory(0))</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Create-dataloaders">
<a class="anchor" href="#Create-dataloaders" aria-hidden="true"><span class="octicon octicon-link"></span></a><strong>Create dataloaders</strong><a class="anchor-link" href="#Create-dataloaders"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">mol_dataset</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Let's inspect one batch to see if everything is already:</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">dls</span><span class="o">.</span><span class="n">one_batch</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">x</span><span class="p">,</span><span class="n">y</span>
</pre></div>

    </div>
</div>
</div>
<details class="description">
      <summary class="btn btn-sm" data-open="Hide Output" data-close="Show Output"></summary>
        <p>
</p>
<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>(tensor([[[[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]],
 
          [[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]],
 
          [[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]]],
 
 
         [[[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]],
 
          [[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]],
 
          [[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]]],
 
 
         [[[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]],
 
          [[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]],
 
          [[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]]],
 
 
         ...,
 
 
         [[[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]],
 
          [[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]],
 
          [[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]]],
 
 
         [[[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]],
 
          [[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]],
 
          [[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]]],
 
 
         [[[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]],
 
          [[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]],
 
          [[0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           ...,
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.],
           [0., 0., 0.,  ..., 0., 0., 0.]]]], device='cuda:0'),
 TensorCategory([0, 0, 1, 1, 0, 1, 1, 0], device='cuda:0'))</pre>
</div>

</div>

</div>
</div>

    </details>
</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It seems everything is in order. Alright! Let's train this beast!</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Fit">
<a class="anchor" href="#Fit" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fit<a class="anchor-link" href="#Fit"> </a>
</h2>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">metrics</span> <span class="o">=</span> <span class="p">[</span><span class="n">Recall</span><span class="p">(</span><span class="n">pos_label</span><span class="o">=</span><span class="mi">1</span><span class="p">),</span><span class="n">Recall</span><span class="p">(</span><span class="n">pos_label</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">Precision</span><span class="p">(</span><span class="n">pos_label</span> <span class="o">=</span> <span class="mi">0</span><span class="p">),</span> <span class="n">MatthewsCorrCoef</span><span class="p">()]</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">cnn_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">resnet18</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span><span class="n">ps</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">

<div class="output_subarea output_stream output_stderr output_text">
<pre>Downloading: "https://download.pytorch.org/models/resnet18-5c106cde.pth" to /home/marcossantana/.cache/torch/hub/checkpoints/resnet18-5c106cde.pth
</pre>
</div>
</div>

<div class="output_area">

<div class="output_subarea output_stream output_stdout output_text">
<pre>
</pre>
</div>
</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p></p>
<div class="flash">
    <svg class="octicon octicon-info octicon octicon-info" viewbox="0 0 16 16" version="1.1" width="16" height="16" aria-hidden="true"><path fill-rule="evenodd" d="M8 1.5a6.5 6.5 0 100 13 6.5 6.5 0 000-13zM0 8a8 8 0 1116 0A8 8 0 010 8zm6.5-.25A.75.75 0 017.25 7h1a.75.75 0 01.75.75v2.75h.25a.75.75 0 010 1.5h-2a.75.75 0 010-1.5h.25v-2h-.25a.75.75 0 01-.75-.75zM8 6a1 1 0 100-2 1 1 0 000 2z"></path></svg>
    <strong>Note: </strong>We are going to use Restnet18 instead of the original Inception architeture. 
</div>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fine_tune</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>recall_score</th>
      <th>recall_score</th>
      <th>precision_score</th>
      <th>matthews_corrcoef</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.108745</td>
      <td>1.240608</td>
      <td>0.331169</td>
      <td>0.716912</td>
      <td>0.654362</td>
      <td>0.050385</td>
      <td>00:15</td>
    </tr>
  </tbody>
</table>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>recall_score</th>
      <th>recall_score</th>
      <th>precision_score</th>
      <th>matthews_corrcoef</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.754158</td>
      <td>0.685205</td>
      <td>0.292208</td>
      <td>0.897059</td>
      <td>0.691218</td>
      <td>0.241307</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.698066</td>
      <td>0.897160</td>
      <td>0.201299</td>
      <td>0.786765</td>
      <td>0.635015</td>
      <td>-0.014106</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.630345</td>
      <td>0.794150</td>
      <td>0.396104</td>
      <td>0.750000</td>
      <td>0.686869</td>
      <td>0.152768</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.607187</td>
      <td>0.601677</td>
      <td>0.512987</td>
      <td>0.794118</td>
      <td>0.742268</td>
      <td>0.317116</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.556304</td>
      <td>0.543766</td>
      <td>0.538961</td>
      <td>0.830882</td>
      <td>0.760943</td>
      <td>0.386714</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.392019</td>
      <td>0.590917</td>
      <td>0.558442</td>
      <td>0.849265</td>
      <td>0.772575</td>
      <td>0.428208</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.336817</td>
      <td>0.561924</td>
      <td>0.487013</td>
      <td>0.882353</td>
      <td>0.752351</td>
      <td>0.409180</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.271662</td>
      <td>0.635271</td>
      <td>0.461039</td>
      <td>0.882353</td>
      <td>0.743034</td>
      <td>0.385314</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.192005</td>
      <td>0.622967</td>
      <td>0.577922</td>
      <td>0.834559</td>
      <td>0.777397</td>
      <td>0.426781</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.189609</td>
      <td>0.632492</td>
      <td>0.636364</td>
      <td>0.819853</td>
      <td>0.799283</td>
      <td>0.461058</td>
      <td>00:18</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>It seems everything went pretty well! In addition, the Matthew's correlation coefficient is quite decent (~0.46).</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Interpretation">
<a class="anchor" href="#Interpretation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Interpretation<a class="anchor-link" href="#Interpretation"> </a>
</h1>
</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interp</span> <span class="o">=</span> <span class="n">ClassificationInterpretation</span><span class="o">.</span><span class="n">from_learner</span><span class="p">(</span><span class="n">learn</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interp</span><span class="o">.</span><span class="n">plot_confusion_matrix</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The performance is pretty decent, if without any kind of data augmentation and hyperparameter optimization.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Let's-try-with-a-little-bit-of-data-augmentation.">
<a class="anchor" href="#Let's-try-with-a-little-bit-of-data-augmentation." aria-hidden="true"><span class="octicon octicon-link"></span></a>Let's try with a little bit of data augmentation.<a class="anchor-link" href="#Let's-try-with-a-little-bit-of-data-augmentation."> </a>
</h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In the original paper, the authors used random rotations of the images. Why is that? Well, since most of the image is empty space, if we distort it even a little bit, by cropping or squishing, it might completly change the molecule represented. Rotating the image is a solution to the data augmentation problem because in this particular case it won't change the meaning of our images.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">dls</span> <span class="o">=</span> <span class="n">mol_dataset</span><span class="o">.</span><span class="n">dataloaders</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span><span class="n">after_batch</span><span class="o">=</span><span class="n">Rotate</span><span class="p">(</span><span class="n">max_deg</span><span class="o">=</span><span class="mi">180</span><span class="p">))</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span> <span class="o">=</span> <span class="n">cnn_learner</span><span class="p">(</span><span class="n">dls</span><span class="p">,</span> <span class="n">resnet18</span><span class="p">,</span> <span class="n">metrics</span><span class="o">=</span><span class="n">metrics</span><span class="p">,</span><span class="n">ps</span><span class="o">=</span><span class="mf">0.25</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">fine_tune</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>recall_score</th>
      <th>recall_score</th>
      <th>precision_score</th>
      <th>matthews_corrcoef</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>1.085553</td>
      <td>0.814067</td>
      <td>0.428571</td>
      <td>0.746324</td>
      <td>0.697595</td>
      <td>0.180596</td>
      <td>00:13</td>
    </tr>
  </tbody>
</table>
</div>

</div>

<div class="output_area">


<div class="output_html rendered_html output_subarea ">
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: left;">
      <th>epoch</th>
      <th>train_loss</th>
      <th>valid_loss</th>
      <th>recall_score</th>
      <th>recall_score</th>
      <th>precision_score</th>
      <th>matthews_corrcoef</th>
      <th>time</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>0</td>
      <td>0.740874</td>
      <td>0.696819</td>
      <td>0.500000</td>
      <td>0.742647</td>
      <td>0.724014</td>
      <td>0.245222</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>1</td>
      <td>0.703036</td>
      <td>0.758111</td>
      <td>0.461039</td>
      <td>0.720588</td>
      <td>0.702509</td>
      <td>0.183554</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>2</td>
      <td>0.653901</td>
      <td>0.586844</td>
      <td>0.383117</td>
      <td>0.867647</td>
      <td>0.712991</td>
      <td>0.289424</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>3</td>
      <td>0.637761</td>
      <td>0.676066</td>
      <td>0.272727</td>
      <td>0.794118</td>
      <td>0.658537</td>
      <td>0.076307</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>4</td>
      <td>0.537117</td>
      <td>0.690890</td>
      <td>0.435065</td>
      <td>0.768382</td>
      <td>0.706081</td>
      <td>0.212265</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>5</td>
      <td>0.483605</td>
      <td>0.649515</td>
      <td>0.448052</td>
      <td>0.860294</td>
      <td>0.733542</td>
      <td>0.341583</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>6</td>
      <td>0.348445</td>
      <td>0.609656</td>
      <td>0.500000</td>
      <td>0.867647</td>
      <td>0.753994</td>
      <td>0.400096</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>7</td>
      <td>0.269874</td>
      <td>0.642070</td>
      <td>0.571429</td>
      <td>0.827206</td>
      <td>0.773196</td>
      <td>0.411629</td>
      <td>00:18</td>
    </tr>
    <tr>
      <td>8</td>
      <td>0.203648</td>
      <td>0.646935</td>
      <td>0.506494</td>
      <td>0.871324</td>
      <td>0.757188</td>
      <td>0.411164</td>
      <td>00:19</td>
    </tr>
    <tr>
      <td>9</td>
      <td>0.198849</td>
      <td>0.674963</td>
      <td>0.506494</td>
      <td>0.871324</td>
      <td>0.757188</td>
      <td>0.411164</td>
      <td>00:18</td>
    </tr>
  </tbody>
</table>
</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interp</span> <span class="o">=</span> <span class="n">ClassificationInterpretation</span><span class="o">.</span><span class="n">from_learner</span><span class="p">(</span><span class="n">learn</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">interp</span><span class="o">.</span><span class="n">plot_confusion_matrix</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">



<div class="output_png output_subarea ">
<img src="data:image/png;base64,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LhYzS87FYmbJuVjMLDkXi5kl1yTvAPbtTX3nLc4+5egl0x+9P5UTzziXI449mRF/vp47/nojjRs34Ud77MuQcy/OL2gDM/Wdt/jVqT9fMv3RB1M54fRz2WGXH3LJr0/n6wULaNykMecM/QPbdN8hx6TplaxYJH0RES0Tbq8L0DMibsumewA/i4jTUr1GfdVls67c8dCzACxatIh9d96S3vsewLjnnmLMIw9y58PP07RZM2bOmJ5z0oaly2ZdGfHgM0Dhc+m7Szd679OPi391GoN/cQ4/2H1vnnliNH+87HxuvP2BnNOmVZ8OhboAh1dPRMR4l8o3jX12DBt13oROG3Xmrltu5ucnnU7TZs0AaNuufc7pGq6xz45ho403oeNGnZHEvC/mAPDF3Dm067BhzunSK3mxSNpd0hhJf5f0hqRbJSlbdr6kcZJelXRj0fzNJT0qabKkiZI2Ay4DfiRpkqTTs+2OlNRI0lRJbYpe821JHSS1l3R39hrjJP2g1O83b6Puu5s+Bw4A4L133+alsc9x5I97c+whfXlt8oSc0zVco0few74HFD6XX55/GVdeej779dyKKy85j1PPuiDndOmVa49lO2AIsBWwKVD9Cz4sInaMiG2A5kC/bP6twDUR8X2gJzANOAd4OiK6R8QV1RuOiMXAP4GDACTtDEyNiE+Bq4ArImJH4GDgptrCSRosabyk8bNnzkj4tsur6uuvefLRB9l7/4MAWLRwIXM+n81f//E4p597Mf990tFERM4pG57qz2Wv/foDcNctN3PmeZfw4HNTOOO8Sxh6zin5BiyBchXL2Ij4MCuBSRQOawB6S3pR0ivAHsDWkloB34mIewEi4quI+HIl278DODR7fFg2DbAXMEzSJOA+oHW2/WVExI0R0SMierRp226132TenhnzCN22+T7rt98AgA4dO7FnnwORxDbde9CokZg187OcUzY8z455hG5bL/1cRt4zgj36HAjA3vsfxGuTJ+YZryTKVSwLih4vAppIWhu4FhgQEd8DhgNrA1qN7T8PbC6pPdAfuCeb3wjYNdvL6R4R34mIuav7JtZ0D993F30O/OmS6d336cfY554E4L1/v0VVVRXrtV0/r3gN1qj7/77k8BSg/QYbMuHFwqDuuOee5L+6bJpXtJLJc/B27ezPGZJaAgMAImIO8KGk/gCSmklqAcwFvrG3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%0A">
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Exporting-the-model">
<a class="anchor" href="#Exporting-the-model" aria-hidden="true"><span class="octicon octicon-link"></span></a>Exporting the model<a class="anchor-link" href="#Exporting-the-model"> </a>
</h1>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now that we trained the model, we can export it and use it for inference.</p>

</div>
</div>
</div>
    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn</span><span class="o">.</span><span class="n">export</span><span class="p">()</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn_inf</span> <span class="o">=</span> <span class="n">load_learner</span><span class="p">(</span><span class="s1">'export.pkl'</span><span class="p">)</span>
</pre></div>

    </div>
</div>
</div>

</div>
    

    
    
<div class="cell border-box-sizing code_cell rendered">
<div class="input">

<div class="inner_cell">
    <div class="input_area">
<div class=" highlight hl-ipython3"><pre><span></span><span class="n">learn_inf</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">mols</span><span class="p">[</span><span class="s1">'molimage'</span><span class="p">][</span><span class="mi">2</span><span class="p">])</span>
</pre></div>

    </div>
</div>
</div>

<div class="output_wrapper">
<div class="output">

<div class="output_area">


<div class="output_html rendered_html output_subarea ">

</div>

</div>

<div class="output_area">



<div class="output_text output_subarea output_execute_result">
<pre>('Inactive', tensor(1), tensor([0.0191, 0.9809]))</pre>
</div>

</div>

</div>
</div>

</div>
    

<div class="cell border-box-sizing text_cell rendered">
<div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h1 id="Fin">
<a class="anchor" href="#Fin" aria-hidden="true"><span class="octicon octicon-link"></span></a>Fin<a class="anchor-link" href="#Fin"> </a>
</h1>
</div>
</div>
</div>
</div>



  </div><!-- from https://github.com/utterance/utterances -->
<script src="https://utteranc.es/client.js"
        repo="marcossantanaioc/fiocruzcheminformatics"
        issue-term="title"
        label="blogpost-comment"
        theme="github-light"
        crossorigin="anonymous"
        async>
</script><a class="u-url" href="/fiocruzcheminformatics/jupyter/2020/12/04/first.html" hidden></a>
</article>
      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/fiocruzcheminformatics/"></data>

  <div class="wrapper">

    <div class="footer-col-wrapper">
      <div class="footer-col">
        <p class="feed-subscribe">
          <a href="/fiocruzcheminformatics/feed.xml">
            <svg class="svg-icon orange">
              <use xlink:href="/fiocruzcheminformatics/assets/minima-social-icons.svg#rss"></use>
            </svg><span>Subscribe</span>
          </a>
        </p>
      </div>
      <div class="footer-col">
        <p>This blog will cover basic and SOTA cheminformatics topics.</p>
      </div>
    </div>

    <div class="social-links"><ul class="social-media-list"><li><a rel="me" href="https://github.com/marcossantanaioc" title="marcossantanaioc"><svg class="svg-icon grey"><use xlink:href="/fiocruzcheminformatics/assets/minima-social-icons.svg#github"></use></svg></a></li></ul>
</div>

  </div>

</footer>
</body>

</html>
